# 功能規格：會員註冊與登入系統以及記帳主頁功能

**功能分支**: `001-member-accounting`  
**建立日期**: 2025-11-05  
**狀態**: 草稿  
**輸入**: 使用者描述: "會員註冊與登入系統以及記帳主頁功能"  
**參考文件**: [使用者原始需求](/doc/SDD-Docs/1-使用者原始需求.md)  
**視覺設計**: [Figma 互動原型](https://www.figma.com/make/TnZdEPvy3eesPPc5wul4Rd/%E5%AE%B6%E5%BA%AD%E8%A8%98%E5%B8%B3APP%E8%A8%BB%E5%86%8A%E7%99%BB%E5%85%A5%E5%8A%9F%E8%83%BD?node-id=0-1&p=f&t=9VpSZLeQmlmw0meK-0)

## 澄清事項

### 會話 2025-11-05

- 問:自動登入的會話有效期限為多久? → 答:7 天
- 問:交易記錄的金額精度為何? → 答:小數點後 2 位
- 問:本階段是否支援密碼修改或忘記密碼功能? → 答:本階段不支援
- 問:交易記錄的時區處理方式? → 答:伺服器時區(UTC)
- 問:網路中斷時本地暫存的資料保留期限? → 答:7 天

## 使用者場景與測試 *(必填)*

### 使用者故事 1 - 新使用者註冊並驗證帳號 (優先級: P1)

新使用者首次使用應用程式時,需要建立帳號並完成 Email 驗證才能開始記帳。

**優先級理由**: 這是所有功能的入口。沒有帳號註冊,使用者無法使用任何記帳功能。這是最基本且必要的功能。

**獨立測試**: 可以透過完整的註冊流程(輸入資料 → 發送驗證碼 → 輸入驗證碼 → 完成註冊)來獨立測試,並確認新帳號成功建立。

**驗收場景**:

1. **Given** 使用者開啟應用程式, **When** 點擊「註冊」按鈕並填寫姓名、Email、密碼(符合規則)、確認密碼, **Then** 系統發送 6 位數驗證碼到 Email
2. **Given** 使用者收到驗證碼, **When** 在 5 分鐘內輸入正確的 6 位數驗證碼, **Then** 帳號成功建立並自動登入
3. **Given** 使用者輸入的密碼不符合規則(未達 8-20 碼或缺少大小寫英文或數字), **When** 點擊註冊, **Then** 顯示錯誤訊息並要求重新輸入
4. **Given** 使用者輸入的密碼與確認密碼不一致, **When** 點擊註冊, **Then** 顯示錯誤訊息「密碼不一致」
5. **Given** 驗證碼已發送但超過 5 分鐘, **When** 使用者輸入驗證碼, **Then** 顯示「驗證碼已過期」並提供重新發送選項
6. **Given** 使用者需要重新發送驗證碼, **When** 點擊「重新發送驗證碼」, **Then** 需等待 60 秒冷卻時間後才能再次發送

---

### 使用者故事 2 - 已註冊使用者登入 (優先級: P1)

已完成註冊的使用者可以使用 Email 和密碼登入,並支援自動登入功能。

**優先級理由**: 與註冊功能同等重要。使用者完成註冊後,後續每次使用都需要登入才能存取個人記帳資料。

**獨立測試**: 使用已註冊的帳號進行登入測試,確認登入成功後能進入記帳主頁,並測試自動登入功能。

**驗收場景**:

1. **Given** 使用者已完成註冊, **When** 輸入正確的 Email 和密碼並點擊登入, **Then** 成功登入並進入記帳主頁
2. **Given** 使用者輸入錯誤的密碼, **When** 點擊登入, **Then** 顯示「Email 或密碼錯誤」訊息
3. **Given** 使用者輸入不存在的 Email, **When** 點擊登入, **Then** 顯示「Email 或密碼錯誤」訊息
4. **Given** 使用者首次成功登入, **When** 關閉應用程式後再次開啟, **Then** 自動登入並直接進入記帳主頁(無需再次輸入密碼)
5. **Given** 使用者已登入, **When** 點擊「登出」, **Then** 清除會話資料並返回登入頁面

---

### 使用者故事 3 - 查看財務概覽 (優先級: P2)

使用者登入後能立即看到個人的財務概覽,包括總收入、總支出和結餘。

**優先級理由**: 這是記帳主頁的核心功能,讓使用者快速了解財務狀況。雖然重要,但需先有註冊登入功能才能使用。

**獨立測試**: 登入後確認主頁顯示財務概覽資訊(初始為零),並在新增收支記錄後驗證數字正確更新。

**驗收場景**:

1. **Given** 使用者首次登入且尚未新增任何記錄, **When** 進入記帳主頁, **Then** 顯示總收入 ¥0、總支出 ¥0、結餘 ¥0
2. **Given** 使用者已有收支記錄, **When** 進入記帳主頁, **Then** 正確顯示累計的總收入、總支出和結餘(收入-支出)
3. **Given** 使用者在記帳主頁, **When** 新增一筆收入或支出, **Then** 財務概覽即時更新顯示最新金額
4. **Given** 使用者在記帳主頁, **When** 頁面載入, **Then** 顯示個人化問候語(例如:「您好,{姓名}」)

---

### 使用者故事 4 - 新增收支記錄 (優先級: P2)

使用者可以新增收入或支出記錄,包括選擇類別、輸入金額和備註。

**優先級理由**: 這是記帳功能的核心操作,讓使用者記錄日常收支。與財務概覽同等重要。

**獨立測試**: 測試新增各種類型(收入/支出)和類別的記錄,確認記錄成功儲存並顯示在交易列表中。

**驗收場景**:

1. **Given** 使用者在記帳主頁, **When** 點擊「新增記錄」並選擇類型為「支出」, **Then** 顯示支出類別選項(餐飲、交通、購物、娛樂、醫療、教育、其他)
2. **Given** 使用者選擇類型為「收入」, **When** 查看類別選項, **Then** 顯示收入類別選項(薪資、獎金、投資、兼職、其他)
3. **Given** 使用者選擇類別和輸入金額, **When** 點擊「儲存」, **Then** 記錄成功新增並自動記錄當前時間
4. **Given** 使用者未輸入金額, **When** 點擊「儲存」, **Then** 顯示錯誤訊息「金額為必填欄位」
5. **Given** 使用者輸入金額和備註, **When** 儲存記錄, **Then** 備註一併儲存並顯示在交易列表中
6. **Given** 使用者未輸入備註, **When** 儲存記錄, **Then** 記錄仍可成功儲存(備註為選填)

---

### 使用者故事 5 - 查看交易記錄列表 (優先級: P3)

使用者可以查看所有歷史收支記錄,最新記錄顯示在最上方,收入和支出以不同顏色區分。

**優先級理由**: 這是輔助功能,讓使用者追蹤歷史記錄。雖然有用,但優先級低於新增記錄和查看概覽。

**獨立測試**: 新增多筆收支記錄後,確認列表正確顯示所有記錄,且排序、顏色、格式都符合需求。

**驗收場景**:

1. **Given** 使用者已新增多筆收支記錄, **When** 查看交易記錄列表, **Then** 所有記錄依時間倒序排列(最新在最上方)
2. **Given** 列表中有收入記錄, **When** 查看, **Then** 收入以綠色顯示,格式為「+金額」
3. **Given** 列表中有支出記錄, **When** 查看, **Then** 支出以紅色顯示,格式為「-金額」
4. **Given** 每筆記錄, **When** 在列表中顯示, **Then** 包含類別、金額、備註(如有)、時間等資訊
5. **Given** 使用者尚未新增任何記錄, **When** 查看交易列表, **Then** 顯示空狀態提示「尚無交易記錄」

---

### 邊緣案例

1. **重複註冊相同 Email**: 當使用者嘗試用已註冊的 Email 註冊時,系統應顯示「此 Email 已被註冊」錯誤訊息,不發送驗證碼,避免資料衝突。

2. **驗證碼多次錯誤輸入**: 使用者連續 5 次輸入錯誤的驗證碼後,系統應鎖定該驗證碼並要求重新發送,防止暴力破解。

3. **網路中斷時儲存記錄**: 使用者在新增收支記錄時網路中斷,應將記錄暫存在本地,待網路恢復後自動同步到伺服器。本地暫存資料保留 7 天,超過 7 天未同步的資料將自動刪除並提示使用者。

4. **同時在多個裝置登入**: 使用者在裝置 A 登入後,又在裝置 B 登入,系統應允許多裝置同時登入,但需確保資料同步一致。

5. **金額輸入超大數值**: 使用者輸入極大的金額(如 999,999,999),系統應設定合理上限(如單筆金額不超過 1,000,000),超過時顯示錯誤訊息。

6. **密碼包含特殊字元**: 使用者輸入包含空格或特殊符號的密碼時,系統應明確規範允許的字元範圍(僅英文、數字),拒絕不符規則的輸入。

7. **登入時帳號未完成驗證**: 使用者註冊後未輸入驗證碼即關閉應用程式,之後嘗試登入,系統應提示「帳號未驗證,請完成 Email 驗證」並提供重新發送驗證碼選項。

## 需求 *(必填)*

## 需求 *(必填)*

### 功能需求

**會員註冊功能**
- **FR-001**: 系統必須提供註冊頁面,包含姓名、Email、密碼、確認密碼輸入欄位
- **FR-002**: 系統必須驗證 Email 格式的有效性(符合標準 Email 格式)
- **FR-003**: 系統必須強制密碼符合規則:8-20 碼、包含大寫英文、小寫英文、數字
- **FR-004**: 系統必須驗證密碼與確認密碼一致
- **FR-005**: 系統必須檢查 Email 是否已被註冊,若已存在則顯示「此 Email 已被註冊」
- **FR-006**: 系統必須在使用者提交註冊表單後,發送 6 位數數字驗證碼到使用者的 Email
- **FR-007**: 驗證碼必須在 5 分鐘內有效
- **FR-008**: 系統必須提供驗證碼輸入介面,並驗證使用者輸入的 6 位數驗證碼
- **FR-009**: 驗證碼連續錯誤 5 次後,系統必須使該驗證碼失效並要求重新發送
- **FR-010**: 系統必須提供「重新發送驗證碼」功能,但需有 60 秒冷卻時間
- **FR-011**: 驗證成功後,系統必須建立新使用者帳號並自動登入

**會員登入功能**
- **FR-012**: 系統必須提供登入頁面,包含 Email 和密碼輸入欄位
- **FR-013**: 系統必須驗證 Email 和密碼是否正確
- **FR-014**: 登入失敗時,系統必須顯示「Email 或密碼錯誤」(不透露具體哪個錯誤)
- **FR-015**: 系統必須在首次登入成功後,儲存會話(session)資訊以支援自動登入,會話有效期限為 7 天
- **FR-016**: 系統必須在使用者重新開啟應用程式時,自動檢查會話有效性並自動登入,若會話已過期(超過 7 天)則要求重新登入
- **FR-017**: 系統必須提供「登出」功能,清除會話資料並返回登入頁面
- **FR-018**: 登入時若帳號未完成 Email 驗證,系統必須顯示「帳號未驗證,請完成 Email 驗證」並提供重新發送驗證碼選項

**記帳主頁 - 財務概覽**
- **FR-019**: 登入後,系統必須顯示記帳主頁,包含財務概覽區塊
- **FR-020**: 財務概覽必須顯示總收入、總支出、結餘(收入-支出)三項數值
- **FR-021**: 首次登入且無任何記錄時,財務概覽必須顯示 ¥0
- **FR-022**: 系統必須即時計算並更新財務概覽(當新增記錄後)
- **FR-023**: 系統必須顯示個人化問候語,格式為「您好,{使用者姓名}」

**記帳主頁 - 新增收支記錄**
- **FR-024**: 系統必須提供「新增記錄」按鈕或入口
- **FR-025**: 新增記錄介面必須包含類型選擇(收入/支出)
- **FR-026**: 當選擇「支出」時,系統必須提供類別選項:餐飲、交通、購物、娛樂、醫療、教育、其他
- **FR-027**: 當選擇「收入」時,系統必須提供類別選項:薪資、獎金、投資、兼職、其他
- **FR-028**: 系統必須提供金額輸入欄位(必填)
- **FR-029**: 系統必須提供備註輸入欄位(選填)
- **FR-030**: 金額必須為數字且不可為負數,精度為小數點後 2 位(例如:123.45)
- **FR-031**: 單筆金額必須設定上限為 1,000,000.00,超過時顯示錯誤訊息
- **FR-032**: 系統必須在儲存記錄時自動記錄當前時間(使用 UTC 時區)
- **FR-033**: 若未輸入金額,系統必須顯示「金額為必填欄位」錯誤訊息
- **FR-034**: 系統必須在成功儲存後,更新財務概覽和交易列表

**記帳主頁 - 交易記錄列表**
- **FR-035**: 系統必須顯示所有歷史交易記錄列表
- **FR-036**: 交易列表必須依時間倒序排列(最新在最上方)
- **FR-037**: 收入記錄必須以綠色顯示,格式為「+金額」
- **FR-038**: 支出記錄必須以紅色顯示,格式為「-金額」
- **FR-039**: 每筆記錄必須顯示:類別、金額、備註(如有)、時間
- **FR-040**: 當無任何記錄時,系統必須顯示空狀態提示「尚無交易記錄」

### 關鍵實體 *(如功能涉及資料,請填寫)*

- **User(使用者)**: 代表應用程式的註冊使用者
  - 關鍵屬性:使用者 ID、姓名、Email、密碼(加密)、帳號驗證狀態、建立時間
  
- **VerificationCode(驗證碼)**: 用於 Email 驗證的一次性驗證碼
  - 關鍵屬性:驗證碼 ID、使用者 Email、6 位數驗證碼、發送時間、過期時間(5 分鐘)、使用狀態
  
- **Transaction(交易記錄)**: 使用者的收支記錄
  - 關鍵屬性:交易 ID、使用者 ID、類型(收入/支出)、類別、金額(精度小數點後 2 位)、備註、記錄時間(UTC 時區)
  - 關聯:屬於特定使用者(User)

- **Session(會話)**: 使用者的登入會話資訊
  - 關鍵屬性:會話 ID、使用者 ID、Token、建立時間、過期時間(建立時間 + 7 天)
  - 關聯:關聯到特定使用者(User)

## 成功標準 *(必填)*

### 可衡量成果

- **SC-001**: 使用者可在 3 分鐘內完成註冊流程(包含 Email 驗證)
- **SC-002**: 已註冊使用者可在 10 秒內完成登入並進入記帳主頁
- **SC-003**: 90% 的使用者能在首次嘗試時成功完成註冊和登入
- **SC-004**: 使用者可在 30 秒內完成一筆收支記錄的新增
- **SC-005**: 財務概覽在新增記錄後 1 秒內更新顯示
- **SC-006**: 減少 80% 因密碼格式不符而註冊失敗的情況(透過即時驗證)

### 效能標準 *(如適用)*

- **PC-001**: 註冊 API 回應時間 < 500ms (p95)
- **PC-002**: 登入 API 回應時間 < 300ms (p95)
- **PC-003**: Email 驗證碼必須在 30 秒內發送
- **PC-004**: 記帳主頁載入時間 < 2 秒(包含財務概覽和交易列表)
- **PC-005**: 新增記錄 API 回應時間 < 400ms (p95)
- **PC-006**: 交易列表查詢 API 回應時間 < 500ms (p95)

### 品質標準

- **QC-001**: 測試覆蓋率 >80% (針對新程式碼)
- **QC-002**: 所有品質關卡通過(依據 constitution 規範)
- **QC-003**: 通過無障礙稽核(最低符合 WCAG 2.1 AA 標準)
- **QC-004**: 所有 API 端點必須有單元測試和整合測試
- **QC-005**: 密碼必須加密儲存(使用 bcrypt 或同等安全演算法)
- **QC-006**: 所有使用者輸入必須經過驗證和清理,防止 SQL Injection 和 XSS 攻擊
- **QC-007**: 程式碼必須通過 Code Review(至少一位資深工程師審核)
- **QC-008**: 所有錯誤訊息必須使用者友善且使用繁體中文

### 使用者體驗標準

- **UX-001**: 所有表單錯誤必須提供清楚的繁體中文錯誤訊息
- **UX-002**: 密碼輸入欄位必須支援顯示/隱藏密碼功能
- **UX-003**: 載入過程必須顯示載入指示器,避免使用者誤以為系統無回應
- **UX-004**: 所有互動元素必須有視覺回饋(例如:按鈕點擊效果)
- **UX-005**: 表單驗證必須提供即時回饋(不必等到提交才顯示錯誤)
- **UX-006**: 支援鍵盤操作(Tab 鍵切換、Enter 鍵提交)
- **UX-007**: 色彩對比度必須符合 WCAG AA 標準(最低 4.5:1)

## 系統限制與假設

### 系統限制

1. 本階段僅支援 Email/密碼登入,不支援第三方登入(如 Google、Facebook)
2. 驗證碼僅支援 Email 發送,不支援簡訊驗證
3. 本階段不支援密碼修改或忘記密碼功能,使用者需妥善保管密碼
4. 單一使用者最多可同時在 5 個裝置上保持登入狀態
5. 交易記錄列表一次最多顯示 100 筆,超過需分頁載入
6. 不支援離線模式,所有操作需網路連線

### 假設

1. 假設使用者擁有有效的 Email 帳號並能接收郵件
2. 假設使用者裝置支援現代瀏覽器或 Mobile App 環境
3. 假設系統具備基本的 Email 發送服務(SMTP 或第三方服務如 SendGrid)
4. 假設使用者了解基本的記帳概念(收入、支出、類別)
5. 假設後端提供安全的密碼加密和會話管理機制
