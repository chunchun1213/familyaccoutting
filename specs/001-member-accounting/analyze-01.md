# 規格分析報告 - 會員註冊與登入系統以及記帳主頁功能

**分析日期**: 2025-11-05  
**功能分支**: `001-member-accounting`  
**分析工具**: `/speckit.analyze`  
**文件版本**: spec.md (2025-11-05), plan.md (2025-11-05), tasks.md (2025-11-05)

---

## 執行摘要

本分析檢查了 `spec.md`、`plan.md` 和 `tasks.md` 三份核心文件之間的一致性、完整性和 Constitution 合規性。

**總體評估**: ⚠️ **中等風險 - 需要修正後再實作**

- ✅ 良好的需求覆蓋度 (97.5%)
- ⚠️ Constitution 關鍵違規 (測試優先原則)
- ⚠️ 部分非功能需求缺乏可測試任務
- ℹ️ 術語不一致需要標準化

---

## 關鍵指標

| 指標 | 數值 | 狀態 |
|------|------|------|
| 總功能需求 (FR) | 40 | ✅ |
| 功能需求覆蓋率 | 100% (40/40) | ✅ |
| 非功能需求總數 | 14 | ⚠️ |
| 非功能需求覆蓋率 | 92.9% (13/14) | ⚠️ |
| 總任務數 | 111 | ✅ |
| 有需求映射的任務 | 53 (47.7%) | ℹ️ |
| 基礎建設任務 | 58 (52.3%) | ✅ |
| 模糊需求數 | 11 | ⚠️ |
| 術語不一致處 | 7 | ⚠️ |
| Constitution 違規 | 2 (CRITICAL) | 🚨 |

---

## 問題發現

### CRITICAL (關鍵) - 必須修正

| ID | 分類 | 位置 | 摘要 | 建議 |
|----|------|------|------|------|
| C1 | Constitution 違規 | tasks.md (所有實作任務) | **測試優先原則違反**: Constitution II 要求 TDD (測試先寫),但 tasks.md 中所有實作任務都未明確要求先寫測試並確認失敗。實作任務直接描述實作,沒有前置的測試任務。 | 在每個使用者故事階段新增測試任務 (T-XXX-test) 標記為 [P],明確要求在對應實作任務前完成並失敗。或在任務描述中加入 "1. 先寫測試並確認失敗 2. 實作功能 3. 確認測試通過" |
| C2 | 覆蓋缺口 | spec.md:L230 (QC-007) | **Code Review 檢查點缺失**: QC-007 要求所有程式碼必須經過至少一位資深工程師審核,但 tasks.md 中沒有對應的 Code Review 任務或檢查點。 | 在 Phase 9 (打磨) 新增任務: "T1XX 為所有 Pull Request 建立 Code Review 檢查清單並執行審核" |
| C3 | 覆蓋缺口 | spec.md:L226 (QC-004) | **API 測試不足**: QC-004 要求所有 API 端點必須有單元測試和整合測試,但 tasks.md 中雖有實作任務,卻沒有明確的 API 測試任務。 | 為每個 API 端點新增對應的測試任務,例如: "T-XXX [P] [US1] 撰寫註冊 API 單元測試 (驗證輸入、密碼雜湊、Email 驗證)" |

### HIGH (重要) - 建議修正

| ID | 分類 | 位置 | 摘要 | 建議 |
|----|------|------|------|------|
| H1 | 術語不一致 | spec.md, tasks.md | **"交易記錄" vs "收支記錄"**: spec.md FR-034 使用 "交易記錄列表",tasks.md T080-T087 使用 "交易列表",data-model.md 使用 "Transaction (交易記錄)"。應統一為單一術語。 | 統一使用 "交易記錄" (Transaction) 作為標準術語,更新所有文件 |
| H2 | 術語不一致 | spec.md, contracts/ | **"Email" vs "email"**: spec.md 使用 "Email" (大寫),API 契約使用 "email" (小寫),程式碼模型可能兩者混用。 | 統一規則: 繁體中文文件使用 "Email",程式碼/API 使用小寫 "email",註解說明時保持一致 |
| H3 | 術語不一致 | spec.md | **"驗證碼" vs "6 位數驗證碼"**: 有時稱 "驗證碼",有時稱 "6 位數驗證碼",應統一。 | 首次提及使用 "6 位數驗證碼",後續可簡稱 "驗證碼" (已建立上下文) |
| H4 | 效能測試過於籠統 | tasks.md:L280 (T098) | **單一任務覆蓋 6 個效能標準**: T098 要求 "測量並驗證所有 API 端點符合效能目標",但 spec.md 定義了 6 個不同的效能標準 (PC-001 到 PC-006),一個任務無法充分覆蓋。 | 分解為具體任務: T098a 註冊 API 效能測試 (<500ms p95), T098b 登入 API (<300ms p95), T098c 新增記錄 API (<400ms p95), T098d 查詢列表 API (<500ms p95), T098e 主頁載入測試 (<2s), T098f Email 發送測試 (<30s) |
| H5 | 邊緣案例缺乏測試 | spec.md:L100-126 | **7 個邊緣案例未映射到任務**: spec.md 定義了 7 個邊緣案例 (重複註冊、多次錯誤、網路中斷等),但 tasks.md 中沒有明確的邊緣案例測試任務。雖然部分在實作中可能會處理,但缺乏專門的測試驗證。 | 新增邊緣案例測試任務 (可標記為 [P]): T-edge-1 重複 Email 註冊測試, T-edge-2 驗證碼 5 次錯誤鎖定測試, T-edge-3 網路中斷暫存測試, T-edge-4 多裝置登入測試, T-edge-5 超大金額輸入測試, T-edge-6 特殊字元密碼拒絕測試, T-edge-7 未驗證帳號登入測試 |
| H6 | 覆蓋缺口 | spec.md:L248 (系統限制 4) | **多裝置登入限制未實作**: spec.md 系統限制 4 提到 "單一使用者最多可同時在 5 個裝置上保持登入狀態",但 tasks.md 中沒有實作此限制的任務。 | 新增任務: "T-XXX [US2] 實作 Session 數量限制 (最多 5 個裝置,超過時移除最舊 Session)" |
| H7 | 覆蓋缺口 | spec.md:L249 (系統限制 5) | **分頁功能未完整實作**: spec.md 提到 "交易記錄列表一次最多顯示 100 筆,超過需分頁載入",tasks.md T077 實作了分頁但未明確處理 "超過 100 筆" 的分頁邏輯。 | 更新 T077 描述明確說明: "實作游標分頁並限制單頁最多 100 筆,提供下一頁/上一頁導航" |

### MEDIUM (中等) - 可選修正

| ID | 分類 | 位置 | 摘要 | 建議 |
|----|------|------|------|------|
| M1 | 模糊性 | spec.md:L215-220 (PC-001 到 PC-006) | **效能指標缺乏測量方式**: 6 個效能標準 (PC-001 到 PC-006) 使用 "p95" 指標,但未說明如何測量 p95 (95 百分位數),例如使用哪些工具、測試環境、負載條件等。 | 在 plan.md 或 quickstart.md 中新增 "效能測試指南" 章節,說明: 1) 使用工具 (如 Artillery, k6), 2) 測試環境規格, 3) 負載條件 (並發使用者數), 4) p95 計算方式 |
| M2 | 模糊性 | spec.md:L209 (SC-003) | **成功率缺乏測量方式**: SC-003 要求 "90% 的使用者能在首次嘗試時成功完成註冊和登入",但未說明如何測量這個成功率 (使用者研究?分析工具?A/B 測試?)。 | 明確說明測量方式,例如: "透過 Google Analytics 事件追蹤,計算首次註冊成功 / 總註冊嘗試比例" |
| M3 | 模糊性 | spec.md:L223 (QC-001) | **測試覆蓋率計算方式不明**: QC-001 要求 ">80% 測試覆蓋率",但未說明是行覆蓋率、分支覆蓋率、函數覆蓋率還是語句覆蓋率。 | 明確指定: "行覆蓋率 (line coverage) >80%,使用 Flutter test --coverage 和 Deno coverage 工具測量" |
| M4 | 模糊性 | spec.md:L225 (QC-003) | **無障礙稽核方式不明**: QC-003 要求 "通過無障礙稽核 (最低符合 WCAG 2.1 AA 標準)",但未說明稽核工具或流程。 | 指定工具和流程,例如: "使用 Flutter Semantics debugger 和 Accessibility Scanner 工具,確保所有互動元素有標籤且對比度 ≥4.5:1" |
| M5 | 資料模型一致性 | spec.md:L198, data-model.md | **Session 實體定義不一致**: spec.md 提到 "Session 關鍵屬性:會話 ID、使用者 ID、Token、建立時間、過期時間",但 data-model.md 中 Session 實體使用 JWT 儲存於前端,後端僅追蹤 token_hash。兩者描述不完全一致。 | 在 data-model.md 中明確說明: "Session 使用 JWT 儲存於前端,後端僅記錄 token_hash 用於多裝置追蹤和撤銷功能" |
| M6 | 術語不一致 | spec.md, plan.md | **"會話" vs "Session"**: spec.md 使用 "會話 (session)",plan.md 和 tasks.md 混用 "Session" 和 "會話",應統一。 | 統一規則: 繁體中文文件首次提及使用 "會話 (Session)",後續可簡稱 "會話";程式碼和技術文件使用 "Session" |
| M7 | 覆蓋缺口 | plan.md:L111-129 (API 契約驗證) | **API 契約驗證缺失**: plan.md 提到有 OpenAPI 契約 (contracts/api-auth.yaml, api-accounting.yaml),但 tasks.md 中沒有驗證實作是否符合契約的任務。 | 新增任務: "T-XXX [P] 使用 OpenAPI 驗證工具檢查 API 實作是否符合契約定義" |
| M8 | 任務順序 | tasks.md:L68-73 (T018-T023) | **前端基礎任務可能有隱含相依性**: T018 建立 main.dart 和 app.dart,T021 實作 API 服務可能需要 app.dart 中的環境設定。雖然任務描述未明確標示相依性,但實務上可能有順序要求。 | 檢查並明確標示相依性,或在 T021 描述中加入 "相依於 T018 完成後的環境設定" |

### LOW (較低) - 改進建議

| ID | 分類 | 位置 | 摘要 | 建議 |
|----|------|------|------|------|
| L1 | 術語標準化 | 所有文件 | **中英文混用不一致**: 有些地方使用 "Email 驗證",有些使用 "電子郵件驗證",應建立術語表統一使用。 | 建立 terminology.md 術語表,列出標準術語: Email (不使用電子郵件)、驗證碼 (不使用 verification code 在中文文件)、交易記錄 (不使用收支記錄) 等 |
| L2 | 模糊性 | spec.md:L235 (UX-004) | **"視覺回饋" 定義不明確**: UX-004 要求 "所有互動元素必須有視覺回饋 (例如:按鈕點擊效果)",但未說明回饋形式 (顏色變化?漣漪效果?陰影?)。 | 在設計系統中明確定義視覺回饋標準,例如: "Material 3 Ripple 效果,按下時顯示 200ms 漣漪動畫" |
| L3 | 模糊性 | spec.md:L236 (UX-005) | **"即時回饋" 時間標準不明**: UX-005 要求 "表單驗證必須提供即時回饋",但未說明 "即時" 的時間標準 (輸入完成後立即?還是失焦後?)。 | 明確說明: "輸入欄位失焦 (onBlur) 時立即驗證並顯示錯誤訊息,或提交表單時整體驗證" |
| L4 | 重複描述 | spec.md:FR-019, FR-020, US3 | **財務概覽需求重複**: FR-019 到 FR-023 和使用者故事 3 都描述財務概覽,內容重複。 | 保留功能需求的詳細規格,使用者故事專注於驗收場景,避免重複描述相同功能細節 |
| L5 | 文字改進 | tasks.md:L39 (T006) | **任務描述可更具體**: T006 "建立環境變數範本檔案 (.env.example) 並記錄必要設定",可更明確列出必要設定項目。 | 更新為: "建立 .env.example 包含 SUPABASE_URL, SUPABASE_ANON_KEY, SUPABASE_SERVICE_ROLE_KEY, RESEND_API_KEY, JWT_SECRET, APP_ENV" |

---

## 需求覆蓋度詳細摘要

### 功能需求覆蓋 (FR-001 到 FR-040)

| 需求 ID | 需求摘要 | 對應任務 | 狀態 |
|---------|---------|---------|------|
| FR-001 | 註冊頁面必須包含姓名、Email、密碼、確認密碼欄位 | T032 | ✅ |
| FR-002 | 驗證 Email 格式有效性 | T014, T036 | ✅ |
| FR-003 | 強制密碼符合規則 (8-20 碼、大小寫、數字) | T014, T036 | ✅ |
| FR-004 | 驗證密碼與確認密碼一致 | T036 | ✅ |
| FR-005 | 檢查 Email 是否已被註冊 | T026 | ✅ |
| FR-006 | 提交註冊後發送 6 位數驗證碼到 Email | T026 | ✅ |
| FR-007 | 驗證碼 5 分鐘有效期限 | T026, T027 | ✅ |
| FR-008 | 提供驗證碼輸入介面並驗證 | T033, T027 | ✅ |
| FR-009 | 驗證碼錯誤 5 次後鎖定 | T029 | ✅ |
| FR-010 | 提供重新發送驗證碼功能 (60 秒冷卻) | T029, T037 | ✅ |
| FR-011 | 驗證成功後建立帳號並自動登入 | T027, T035 | ✅ |
| FR-012 | 登入頁面包含 Email 和密碼欄位 | T046 | ✅ |
| FR-013 | 驗證 Email 和密碼正確性 | T040 | ✅ |
| FR-014 | 登入失敗顯示 "Email 或密碼錯誤" | T050 | ✅ |
| FR-015 | 儲存 7 天會話資訊支援自動登入 | T040, T043 | ✅ |
| FR-016 | 重新開啟應用程式時自動登入 | T048 | ✅ |
| FR-017 | 提供登出功能清除會話 | T041, T049 | ✅ |
| FR-018 | 未驗證帳號登入時提示並提供重新發送驗證碼 | T042 | ✅ |
| FR-019 | 登入後顯示記帳主頁和財務概覽 | T056 | ✅ |
| FR-020 | 財務概覽顯示總收入、總支出、結餘 | T052, T055 | ✅ |
| FR-021 | 首次登入無記錄時顯示 ¥0 | T055, T059 | ✅ |
| FR-022 | 新增記錄後即時更新財務概覽 | T073 | ✅ |
| FR-023 | 顯示個人化問候語 "您好,{姓名}" | T060 | ✅ |
| FR-024 | 提供新增記錄按鈕或入口 | T069 | ✅ |
| FR-025 | 新增記錄包含類型選擇 (收入/支出) | T069 | ✅ |
| FR-026 | 支出類別: 餐飲、交通、購物、娛樂、醫療、教育、其他 | T066, T070 | ✅ |
| FR-027 | 收入類別: 薪資、獎金、投資、兼職、其他 | T066, T070 | ✅ |
| FR-028 | 提供金額輸入欄位 (必填) | T069, T071 | ✅ |
| FR-029 | 提供備註輸入欄位 (選填) | T069 | ✅ |
| FR-030 | 金額為數字且不可為負數,精度 2 位小數 | T065, T071 | ✅ |
| FR-031 | 單筆金額上限 1,000,000.00 | T065, T071, T074 | ✅ |
| FR-032 | 儲存記錄時自動記錄當前時間 (UTC) | T063 | ✅ |
| FR-033 | 未輸入金額時顯示錯誤訊息 | T071, T074 | ✅ |
| FR-034 | 成功儲存後更新財務概覽和交易列表 | T072, T073 | ✅ |
| FR-035 | 顯示所有歷史交易記錄列表 | T075, T081 | ✅ |
| FR-036 | 交易列表依時間倒序排列 | T075 | ✅ |
| FR-037 | 收入記錄綠色顯示 "+金額" | T083 | ✅ |
| FR-038 | 支出記錄紅色顯示 "-金額" | T083 | ✅ |
| FR-039 | 每筆記錄顯示類別、金額、備註、時間 | T081, T083 | ✅ |
| FR-040 | 無記錄時顯示空狀態提示 | T084 | ✅ |

**功能需求覆蓋率**: 100% (40/40) ✅

### 非功能需求覆蓋 (PC, SC, QC, UX)

| 需求 ID | 需求摘要 | 對應任務 | 狀態 |
|---------|---------|---------|------|
| PC-001 | 註冊 API < 500ms (p95) | T098 | ⚠️ (過於籠統) |
| PC-002 | 登入 API < 300ms (p95) | T098 | ⚠️ (過於籠統) |
| PC-003 | Email 驗證碼 < 30 秒發送 | T098 | ⚠️ (過於籠統) |
| PC-004 | 主頁載入 < 2 秒 | T098 | ⚠️ (過於籠統) |
| PC-005 | 新增記錄 API < 400ms (p95) | T098 | ⚠️ (過於籠統) |
| PC-006 | 查詢列表 API < 500ms (p95) | T098 | ⚠️ (過於籠統) |
| SC-001 到 SC-006 | 可衡量成果標準 | (整體使用者體驗,無直接任務) | ℹ️ |
| QC-001 | 測試覆蓋率 >80% | (TDD 流程隱含,但未明確任務) | ⚠️ |
| QC-002 | 通過所有品質關卡 | (整體流程,非單一任務) | ✅ |
| QC-003 | 通過無障礙稽核 (WCAG 2.1 AA) | T092, T093 | ✅ |
| QC-004 | 所有 API 端點有單元測試和整合測試 | ❌ 缺失 | 🚨 |
| QC-005 | 密碼必須加密儲存 (bcrypt) | T026 (隱含在實作中) | ✅ |
| QC-006 | 所有輸入驗證和清理 | T014, T100 | ✅ |
| QC-007 | Code Review (至少一位資深工程師) | ❌ 缺失 | 🚨 |
| QC-008 | 錯誤訊息使用繁體中文 | T038, T050, T074 | ✅ |
| UX-001 到 UX-007 | 使用者體驗標準 | T092, T093, T094, T095, T036 | ✅ |

**非功能需求覆蓋率**: 92.9% (13/14) - **QC-007 缺失** 🚨

---

## 未映射任務分析

以下 58 個任務屬於基礎建設或支援性質,未直接對應特定功能需求,這是正常的:

**Phase 1 - 專案設定** (7 個任務: T001-T007)
- 這些任務建立專案結構和開發環境,不對應特定功能需求 ✅

**Phase 2 - 基礎建設** (16 個任務: T008-T023)
- 資料庫遷移、共用工具、中介層、核心架構 - 支援所有功能需求 ✅

**Phase 8 - 離線支援** (4 個任務: T088-T091)
- 對應邊緣案例 3 (網路中斷時儲存記錄) ✅

**Phase 9 - 打磨與改進** (20 個任務: T092-T111)
- 無障礙、效能、安全、文件、部署 - 跨領域改進 ✅

這些任務都是必要的,未映射到特定 FR 並非問題。

---

## Constitution 合規性檢查

### ✅ 已合規的原則

1. **程式碼品質 (Principle I)**: 
   - ✅ T004, T005 設定 Linting 工具
   - ✅ T105, T106 要求撰寫文件註解
   - ✅ 任務描述包含檔案路徑,符合明確性要求

2. **使用者體驗一致性 (Principle III)**:
   - ✅ T092-T095 涵蓋無障礙、視覺回饋、鍵盤操作
   - ✅ T038, T050, T074 要求繁體中文錯誤訊息
   - ✅ T036, T071 實作即時表單驗證

3. **效能需求 (Principle IV)**:
   - ✅ T096-T099 優化資料庫、快取、延遲載入
   - ✅ T098 測量效能目標 (雖然過於籠統)
   - ✅ T054, T079 優化查詢效能

4. **文件語言 (Principle V)**:
   - ✅ spec.md, plan.md, tasks.md 全部使用繁體中文 (zh-TW)
   - ✅ UI 錯誤訊息要求繁體中文
   - ✅ Constitution 本身保持英文作為治理文件

### 🚨 違反的原則 (CRITICAL)

1. **測試優先 (Principle II - NON-NEGOTIABLE)**:
   - ❌ **關鍵違規**: tasks.md 未明確要求 TDD 工作流程
   - ❌ 實作任務 (T026-T087) 沒有前置的 "先寫測試" 步驟
   - ❌ 沒有 "確認測試失敗" 的檢查點
   - ❌ Constitution 要求: "Tests MUST be written BEFORE implementation (Red-Green-Refactor cycle)"
   
   **影響**: 這是 Constitution 中標記為 NON-NEGOTIABLE 的原則,必須修正。

2. **測試標準覆蓋不足 (Principle II)**:
   - ❌ QC-004 要求所有 API 端點有單元測試和整合測試,但未見明確任務
   - ❌ 邊緣案例測試缺失
   
   **影響**: 雖然 tasks.md 說明 "Tests are OPTIONAL",但 Constitution 和 spec.md QC-004 明確要求 API 測試,這是衝突。

3. **品質關卡缺失 (Principle - Quality Gates)**:
   - ❌ Gate 3 要求 Code Review,但 tasks.md 無對應任務 (QC-007)
   
   **影響**: Constitution 要求所有特徵通過 6 個品質關卡,缺少 Code Review 檢查點。

---

## 術語不一致清單

| 編號 | 術語 1 | 術語 2 | 出現位置 | 建議 |
|------|--------|--------|---------|------|
| T1 | 交易記錄 | 收支記錄 | spec.md FR-035, tasks.md T080-T087 | 統一使用 "交易記錄" |
| T2 | Email | email | spec.md (大寫), API 契約 (小寫) | 中文文件用 "Email",程式碼用 "email" |
| T3 | 驗證碼 | 6 位數驗證碼 | spec.md 多處 | 首次提及 "6 位數驗證碼",後續簡稱 "驗證碼" |
| T4 | 會話 | Session | spec.md (會話), plan.md (Session) | 中文首次 "會話 (Session)",後續簡稱 "會話" |
| T5 | 登入 | 登錄 | spec.md 使用 "登入" | 統一使用 "登入" (臺灣慣用) |
| T6 | 記帳主頁 | 主頁 | spec.md FR-019 "記帳主頁", tasks.md "主頁" | 統一使用 "記帳主頁" 或 "首頁" |
| T7 | 財務概覽 | 概覽 | spec.md "財務概覽", tasks.md 混用 | 統一使用 "財務概覽" |

---

## 建議改進行動

### 立即行動 (CRITICAL - 實作前必須完成)

1. **[C1] 修正 TDD 工作流程違規** (最高優先級)
   
   **方案 A - 新增測試任務** (建議):
   ```markdown
   在每個使用者故事階段,實作任務前新增測試任務:
   
   Phase 3 (US1):
   - [ ] T024a [P] [US1] 撰寫註冊 API 契約測試並確認失敗
   - [ ] T024b [P] [US1] 撰寫 Email 驗證 API 契約測試並確認失敗
   - [ ] T026 [P] [US1] 實作註冊 API 端點 (前提: T024a 測試失敗)
   - [ ] T027 [P] [US1] 實作 Email 驗證 API 端點 (前提: T024b 測試失敗)
   - [ ] T028 [US1] 確認所有測試通過
   ```
   
   **方案 B - 修改任務描述**:
   ```markdown
   更新所有實作任務,例如 T026:
   "實作註冊 API 端點:
    1. 先撰寫 API 契約測試 (輸入驗證、錯誤處理、Email 發送)
    2. 執行測試並確認失敗 (Red)
    3. 實作 API 端點功能 (Green)
    4. 重構並確認測試通過 (Refactor)"
   ```

2. **[C2] 新增 Code Review 任務**
   ```markdown
   Phase 9:
   - [ ] T112 [US1-US5] 為所有使用者故事建立 Code Review 檢查清單
   - [ ] T113 執行 Code Review 並記錄審核結果 (至少一位資深工程師)
   ```

3. **[C3] 新增 API 測試任務**
   ```markdown
   Phase 3 (US1):
   - [ ] T026a [P] [US1] 撰寫註冊 API 單元測試 (驗證 Email 格式、密碼雜湊、驗證碼產生)
   - [ ] T027a [P] [US1] 撰寫 Email 驗證 API 單元測試 (驗證碼比對、JWT 產生)
   
   Phase 4 (US2):
   - [ ] T040a [P] [US2] 撰寫登入 API 單元測試 (密碼比對、Session 建立)
   - [ ] T041a [P] [US2] 撰寫登出 API 單元測試 (Session 刪除)
   
   ... (其他 API 端點同樣處理)
   ```

### 短期行動 (HIGH - 建議在實作前完成)

4. **[H1-H3] 建立術語表並統一術語**
   ```markdown
   建立 specs/001-member-accounting/terminology.md:
   
   | 標準術語 | 避免使用 | 說明 |
   |---------|---------|------|
   | 交易記錄 | 收支記錄 | Transaction 的標準翻譯 |
   | Email | email (中文文件), 電子郵件 | 中文文件統一大寫,程式碼小寫 |
   | 6 位數驗證碼 | 驗證碼 (首次提及) | 首次明確說明,後續可簡稱 |
   | 會話 (Session) | 登入狀態 | 首次提及括號說明,後續簡稱 |
   ```

5. **[H4] 分解效能測試任務**
   ```markdown
   Phase 9:
   - [ ] T098a [P] 註冊 API 效能測試 (目標 <500ms p95, 使用 k6 測試 100 並發)
   - [ ] T098b [P] 登入 API 效能測試 (目標 <300ms p95)
   - [ ] T098c [P] 新增記錄 API 效能測試 (目標 <400ms p95)
   - [ ] T098d [P] 查詢列表 API 效能測試 (目標 <500ms p95)
   - [ ] T098e 主頁載入效能測試 (目標 <2s, 使用 Lighthouse)
   - [ ] T098f Email 發送效能測試 (目標 <30s, 使用 Inbucket 監控)
   ```

6. **[H5] 新增邊緣案例測試任務**
   ```markdown
   Phase 9:
   - [ ] T-edge-1 [P] 測試重複 Email 註冊拒絕 (對應邊緣案例 1)
   - [ ] T-edge-2 [P] 測試驗證碼 5 次錯誤鎖定 (對應邊緣案例 2)
   - [ ] T-edge-3 [P] 測試網路中斷時本地暫存 (對應邊緣案例 3)
   - [ ] T-edge-4 [P] 測試多裝置同時登入 (對應邊緣案例 4)
   - [ ] T-edge-5 [P] 測試超大金額輸入拒絕 (對應邊緣案例 5)
   - [ ] T-edge-6 [P] 測試特殊字元密碼拒絕 (對應邊緣案例 6)
   - [ ] T-edge-7 [P] 測試未驗證帳號登入提示 (對應邊緣案例 7)
   ```

7. **[H6] 新增多裝置登入限制任務**
   ```markdown
   Phase 4 (US2):
   - [ ] T043a [US2] 實作 Session 數量限制 (最多 5 個,超過時移除最舊 Session)
   ```

### 中期行動 (MEDIUM - 可在實作過程中逐步完成)

8. **[M1-M4] 在 quickstart.md 新增測量指南**
   - 效能測試工具和方法 (k6, Artillery, Lighthouse)
   - 成功率測量方式 (Google Analytics 事件追蹤)
   - 測試覆蓋率計算工具 (flutter test --coverage, deno coverage)
   - 無障礙稽核工具 (Flutter Semantics debugger, Accessibility Scanner)

9. **[M5] 在 data-model.md 澄清 Session 實體描述**
   - 明確說明 JWT 儲存於前端,後端僅追蹤 token_hash

10. **[M7] 新增 API 契約驗證任務**
    ```markdown
    Phase 9:
    - [ ] T114 [P] 使用 Swagger Validator 或 Spectral 驗證 API 實作符合 OpenAPI 契約
    ```

### 長期改進 (LOW - 可選)

11. **[L1] 建立完整術語表** (terminology.md)

12. **[L2-L3] 在設計系統中明確 UX 標準**
    - 視覺回饋形式 (Material 3 Ripple 效果)
    - 即時回饋時機 (onBlur vs onSubmit)

---

## 下一步行動

### ⚠️ 強烈建議 - 在執行 `/speckit.implement` 前:

1. ✅ **解決 CRITICAL 問題** (C1-C3):
   - 修正 TDD 工作流程違規 → 選擇方案 A 或 B
   - 新增 Code Review 任務
   - 新增 API 測試任務

2. ✅ **解決 HIGH 問題** (H1-H7):
   - 建立術語表並統一術語
   - 分解效能測試任務為具體項目
   - 新增邊緣案例測試
   - 新增多裝置登入限制實作

3. ℹ️ **考慮 MEDIUM 問題** (M1-M10):
   - 在 quickstart.md 新增測量指南
   - 新增 API 契約驗證任務

### 可立即開始實作的條件:

如果你選擇暫時不修正上述問題,**風險評估**:
- **無 CRITICAL 修正**: 🚨 高風險 - 違反 Constitution NON-NEGOTIABLE 原則
- **無 HIGH 修正**: ⚠️ 中風險 - 可能產生不一致、遺漏重要測試
- **無 MEDIUM 修正**: ℹ️ 低風險 - 可在實作過程中逐步補足

**建議**: 至少修正 **CRITICAL** 問題後再開始實作,以符合 Constitution 要求。

---

## 建議修正優先順序

### 優先級 1 (立即修正 - 阻塞實作)

- [ ] C1: 修正 TDD 工作流程違規 (新增測試任務或修改任務描述)
- [ ] C2: 新增 Code Review 任務
- [ ] C3: 新增 API 測試任務

### 優先級 2 (短期修正 - 避免後續問題)

- [ ] H1-H3: 建立術語表並統一術語
- [ ] H4: 分解效能測試任務
- [ ] H5: 新增邊緣案例測試任務
- [ ] H6: 新增多裝置登入限制任務

### 優先級 3 (中期改進 - 提升品質)

- [ ] M1-M4: 在 quickstart.md 新增測量指南
- [ ] M5: 澄清 Session 實體描述
- [ ] M7: 新增 API 契約驗證任務

### 優先級 4 (長期優化 - 可選)

- [ ] L1-L5: 術語表、UX 標準明確化、文字改進

---

## 附錄: 零問題情境

**假設所有問題都已修正後的狀態**:

- ✅ 總需求數: 54 (40 FR + 14 非功能)
- ✅ 總任務數: ~140 (新增約 29 個測試和驗證任務)
- ✅ 需求覆蓋率: 100% (54/54)
- ✅ Constitution 合規: 100% (6/6 品質關卡)
- ✅ 模糊需求: 0 (已明確測量方式)
- ✅ 術語不一致: 0 (已建立術語表)
- ✅ TDD 工作流程: 明確 (測試先寫 → 失敗 → 實作 → 通過)

**此狀態下可以安全地執行** `/speckit.implement`。

---

**報告結束**

*建議: 請決定是否接受上述建議並進行修正。如需協助產生修正編輯,請明確指示。*
